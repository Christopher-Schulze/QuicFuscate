# StealthQUIC-VPN Specification

## Project Overview
A modular, production-ready VPN protocol implemented in Go, designed to emulate HTTPS/QUIC traffic with advanced stealth features, robust error correction, and high performance.

## 1. Language & Structure
- **Language**: Go (1.20+)
- **Modules**: Go Modules
- **Architecture**:
  - **Modular Design**: Separated packages for:
    - `proto/` (protocol logic)
    - `net/` (network layer)
    - `crypto/` (encryption)
    - `fec/` (FEC implementation)
    - `cli/` (command-line interface)
    - `tun/` (TUN/TAP interface)
  - **Documentation**: English comments and docstrings
  - **Error Handling**: Production-grade with `log` and `errors` packages
  - **Logging**: Configurable verbosity (debug/release)

## 2. Network Layer
- **Transport**: QUIC over UDP (port 443)
- **Library**: `lucas-clemente/quic-go`
- **Features**:
  - Userland-only (no root required)
  - Single-path only (no multipath)
  - Adaptive MTU detection

## 3. Encryption
- **Primary Cipher**: AES-128-GCM (hardware-accelerated)
- **Fallback**: Ascon128 (via `github.com/gtank/cryptopasta/ascon`)
- **Key Exchange**: X25519/ECDH via TLS 1.3/QUIC handshake
- **Session Resumption**: 0-RTT support

## 4. Stealth Layer
- **Fake TLS**: Mimics real browser traffic (Chrome/Edge/Firefox)
  - Exact ClientHello, SNI, CipherSuites, Extensions
  - Randomized SNI rotation (e.g., `google.com`, `cloudflare.com`)
- **Packet Characteristics**:
  - Realistic sizes and sequences
  - No artificial padding
  - Randomized send intervals (no artificial delays)

## 5. FEC Layer (Always Active)
- **Codecs**:
  - **RaptorQ**: For file/download robustness
  - **Tetrys**: For real-time low-latency
- **Adaptive Redundancy**: Auto-adjusts based on packet loss
- **Implementation**: Go-native first, CGo as fallback

## 6. MTU & Batching
- **Adaptive MTU**: Detected during connection setup
- **Batching**: Aggregates small packets without artificial delays

## 7. Session Management
- **TUN/TAP**: `songgao/water` library
- **Cross-Platform**: Linux/macOS/Windows
- **Docker-Ready**: No root required

## 8. Keepalive/Heartbeat
- **Default**: Every 20s (configurable 5-60s)
- **Protocol**: Ping/No-Op over existing session

## 9. Logging & Monitoring
- **Features**:
  - Connection setup logs
  - FEC status
  - Reconnect events
  - TLS handshake details
- **Modes**: Verbose/Silent (configurable)

## 10. CLI & Configuration
- **Format**: TOML/YAML
- **Options**:
  - Cipher selection
  - FEC tuning
  - Keepalive interval
  - SNI list
  - Logging verbosity
- **Example Config**: Included in repo

## 11. Documentation
- **README**:
  - Feature overview
  - Architecture diagram (ASCII)
  - Setup guide
  - Security notes
- **Code Comments**: English documentation

## 12. Additional Requirements
- **Asynchronous**: Non-blocking network/crypto operations
- **Dependencies**: Fully documented in `go.mod`
- **Tests**: Unit tests for core functions
- **No Dead Code**: Clean, minimal repo

## Architecture Diagram (ASCII)
```
+-------------------+
|    CLI/Config     |
+--------+----------+
         |
         v
+--------+----------+
|    TUN/TAP    |
+--------+----------+
         |
         v
+--------+----------+
|    FEC Layer    |
+--------+----------+
         |
         v
+--------+----------+
|   QUIC Stack    |
+--------+----------+
         |
         v
+--------+----------+
|  Crypto/ TLS    |
+-------------------+
```

## Example Configuration (TOML)
```toml
[vpn]
cipher = "auto"  # "aes-128-gcm", "ascon", "auto"
fec = true
keepalive_interval = 20
sni_list = ["google.com", "cloudflare.com"]
log_level = "info"
```

## Roadmap
1. Implement QUIC transport with TLS mimicry
2. Add FEC layer with RaptorQ/Tetrys
3. Integrate TUN/TAP interface
4. Add CLI and config parsing
5. Write unit tests and documentation
6. Optimize for performance and stealth
